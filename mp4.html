<!DOCTYPE html>
<html>
<head>
    <title>MP4 Player</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: black; }
        video { width: 100vw; height: 100vh; object-fit: contain; } /* 'contain' keeps aspect ratio, 'cover' fills the space */
    </style>
</head>
<body>
    <video id="videoPlayer" controls autoplay></video>

    <script>
        const videoPlayer = document.getElementById('videoPlayer');
        const urlParams = new URLSearchParams(window.location.search);
        const mp4Url = urlParams.get('id');
        const startTime = urlParams.get('start'); // FÃ¼r Startzeit aus der URL

        if (mp4Url) {
            videoPlayer.src = mp4Url;
            if (startTime) {
                videoPlayer.currentTime = parseFloat(startTime);
            }
        } else {
            console.error("No MP4 URL provided in 'id' parameter.");
        }

        // Send events back to Garry's Mod
        function sendEvent(id, data) {
            if (window.medialiblua && window.medialiblua.Event) {
                window.medialiblua.Event(id, JSON.stringify(data));
            } else {
                console.warn("medialiblua.Event not available, cannot send event:", id, data);
            }
        }

        videoPlayer.addEventListener('play', () => {
            sendEvent('stateChange', { state: 'playing', time: videoPlayer.currentTime });
        });
        videoPlayer.addEventListener('pause', () => {
            sendEvent('stateChange', { state: 'paused', time: videoPlayer.currentTime });
        });
        videoPlayer.addEventListener('ended', () => {
            sendEvent('stateChange', { state: 'ended', time: videoPlayer.currentTime });
        });
        videoPlayer.addEventListener('playing', () => {
            sendEvent('stateChange', { state: 'playing', time: videoPlayer.currentTime });
        });
        videoPlayer.addEventListener('waiting', () => {
            sendEvent('stateChange', { state: 'buffering', time: videoPlayer.currentTime });
        });
        videoPlayer.addEventListener('error', (e) => {
            sendEvent('error', { message: 'Video playback error', detail: e.message || 'unknown' });
        });

        // Implement simple commands for medialibDelegate (optional but good practice)
        window.medialibDelegate = {
            run: function(command, args) {
                if (command === 'setVolume' && args && typeof args.vol === 'number') {
                    videoPlayer.volume = args.vol;
                } else if (command === 'seek' && args && typeof args.time === 'number') {
                    videoPlayer.currentTime = args.time;
                } else if (command === 'play') {
                    videoPlayer.play().catch(e => console.error("Play failed:", e));
                } else if (command === 'pause') {
                    videoPlayer.pause();
                }
                // setQuality is typically not directly supported by native HTML video,
                // but you could add logic here if you have multiple source qualities.
            }
        };

        // Initial state update after video loads metadata
        videoPlayer.addEventListener('loadedmetadata', () => {
            sendEvent('playerLoaded', {});
            sendEvent('stateChange', { state: videoPlayer.paused ? 'paused' : 'playing', time: videoPlayer.currentTime });
        });

    </script>
</body>
</html>
