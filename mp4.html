<!DOCTYPE html>
<html>
<head>
	<link href="https://vjs.zencdn.net/5.10.4/video-js.css" rel="stylesheet" />
	<style type="text/css">
	html, body {
		height: 100%;
		margin: 0;
		padding: 0;
		overflow: hidden;
		background-color: black;
	}
	#player {
		width: 100%;
		height: 100%;
	}
	</style>
</head>
<body>
	<video id="player" class="video-js vjs-default-skin" controls preload="auto" width="100%" height="100%">
		<source id="player-mp4src" type="video/mp4">
	</video>

	<script type="text/javascript" src="medialib.js"></script>
	<script src="https://vjs.zencdn.net/5.10.4/video.js"></script>

	<script type="text/javascript">
		// Erstellt das Event-Delegat-Objekt für medialib
		medialibDelegate = medialib.createEventDelegate({
			play: function() {
				this.play();
			},
			pause: function() {
				this.pause();
			},
			seek: function(obj) {
				this.currentTime(obj.time);
			},
			setVolume: function(obj) {
				this.volume(obj.vol);
			}
		});

		var params = medialib.getParams();
		var id = decodeURIComponent(params.id || params.vid || "");
		var startTime = parseFloat(params.start || 0);

		if (!id) {
			console.error("Kein MP4-Link übergeben!");
		} else {
			document.getElementById("player-mp4src").setAttribute("src", id);
			
			videojs("player", {"controls": true, "preload": "auto"}, function() {
				this.load();

				this.ready(() => {
					const player = this;

					player.on("loadedmetadata", function() {
						if (!isNaN(startTime)) {
							player.currentTime(startTime);
						}
						player.play().catch((err) => {
							console.warn("Autoplay blockiert:", err);
							medialib.emitEvent("error", { message: "Autoplay blockiert", detail: err.message });
						});
					});

					player.on("play", function() {
						medialib.emitEvent("stateChange", {state: "playing", time: player.currentTime()});
					});
					player.on("pause", function() {
						medialib.emitEvent("stateChange", {state: "paused", time: player.currentTime()});
					});
					player.on("ended", function() {
						medialib.emitEvent("stateChange", {state: "ended", time: player.currentTime()});
					});
					player.on("seeking", function() {
						medialib.emitEvent("stateChange", {state: "buffering", time: player.currentTime()});
					});
					player.on("seeked", function() {
						medialib.emitEvent("stateChange", {state: "playing", time: player.currentTime()});
					});

					medialibDelegate.playerLoaded(player);
				});
			});
		}
	</script>
</body>
</html>
